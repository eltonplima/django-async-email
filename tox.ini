[tox]
minversion = 3.4.0
provision_tox_env = .tox
envlist =
    py{37,38}-dj{22,30,31}-celery{42,43,44},
skip_missing_interpreters = true
requires = tox-venv
           setuptools >= 30.0.0
skipsdist = true
sitepackages=false

[pytest]
testpaths=tests
filterwarnings=error

[flake8]
max-complexity = 10
max-line-length = 88
ignore=E203,W503
exclude=
    .git,
    .tox,
    .env,
    .venv,
    .pytest_cache,
    __pycache__,

[testenv]
usedevelop=True
skip_install=
    selfcheck: True
    test: False
deps=
    pytest
    setuptools >= 42
    pytest-xdist[psutil]
    wheel
;changedir = tests
commands= python -m pytest --basetemp="{envtmpdir}" --confcutdir=.. {posargs}
extras =
    toml
    dev

[testenv:upload]
deps=
    wheel
    twine
commands=
    python setup.py clean --all rotate -k 0 -m .whl,.tar.gz,.zip
    python setup.py -q egg_info
    python setup.py -q sdist --formats zip bdist_wheel register

[testenv:dist]
deps= wheel
whitelist_externals = rm
commands=
    python setup.py -q clean --all
    python setup.py -q rotate -k 0 -m .egg,.zip,.whl,.tar.gz
    python setup.py -q egg_info
    python setup.py -q sdist --formats zip,bztar bdist_wheel upload

[testenv:flake8]
skip_install=True
deps=
    flake8
    mccabe
commands =
    flake8 src/async_email/ test/ setup.py
